/*
  This class has been generated by the Code Generator
*/

package com.cica.uw;

import com.cordys.cpc.bsf.busobject.BusObjectConfig;
import com.cordys.cpc.bsf.busobject.BusObjectIterator;
import com.cordys.cpc.bsf.busobject.QueryObject;

public class tbl_agent_master extends tbl_agent_masterBase
{
    public tbl_agent_master()
    {
        this((BusObjectConfig)null);
    }

    public tbl_agent_master(BusObjectConfig config)
    {
        super(config);
    }

    public static BusObjectIterator<com.cica.uw.tbl_agent_master> getAgentHierarchyTreeForAgentCode(String agentCode, com.cordys.cpc.bsf.query.Cursor cursor)
    {
        String queryText="WITH agentHierarchy(countVal,agent_code,first_name,last_name,status,position,boss_code) AS "
		+"(SELECT countVal=1,agent_code,first_name,last_name,status,position,LTRIM(boss_code) FROM tbl_agent_master "
		+"WHERE agent_code = :agentCode "
		+"UNION ALL "
		+"SELECT AH.countVal+1,AM.agent_code,AM.first_name,AM.last_name,AM.status,AM.position,LTRIM(AM.boss_code) FROM tbl_agent_master AS AM "
		+"JOIN agentHierarchy AS AH ON AM.agent_code = AH.boss_code "
		+"WHERE LTRIM(AM.boss_code)!=AM.agent_code or LTRIM(AM.boss_code)!=NULL) "
		+"SELECT countVal,agent_code,first_name+' '+last_name as first_name,status,position,boss_code FROM agentHierarchy "
		+"UNION ALL "
		+"SELECT top 1 AH.countVal+1,TAM.agent_code,TAM.first_name+' '+TAM.last_name as first_name,TAM.status,TAM.position,LTRIM(TAM.boss_code) "
		+"FROM tbl_agent_master as TAM JOIN agentHierarchy AS AH ON TAM.agent_code = AH.boss_code "
		+"WHERE TAM.agent_code = (select top 1 boss_code from agentHierarchy where boss_code!='' and agent_code!=boss_code order by countVal desc)";
        QueryObject query=new QueryObject(queryText);
        query.addParameter("agentCode", "tbl_agent_master.agent_code",QueryObject.PARAM_STRING, agentCode);
        query.setResultClass(tbl_agent_master.class);
        query.setCursor(cursor);
        return query.getObjects();
    }
	  public static BusObjectIterator<com.cica.uw.tbl_agent_master> getTopAgentCodeDetails(String AgentCode)
    {
       String queryText="select top 1 * from tbl_agent_master where agent_code=:AgentCode ";
        QueryObject query=new QueryObject(queryText);
        query.addParameter("AgentCode", "tbl_agent_master.agent_code",QueryObject.PARAM_STRING, AgentCode);
        query.setResultClass(tbl_agent_master.class);
       
        return query.getObjects();
    }
}
